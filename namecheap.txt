NAMECHEAP DOMAIN -> VPS HOSTING (Frontend + Backend + PostgreSQL)
NOOB FRIENDLY COPY/PASTE GUIDE for amaK

Your domain
- https://amabakent.uk (Frontend)
- https://api.amabakent.uk (Backend API)

Before you start (you need these 3 things)
1) Your VPS public IP address (example: 203.0.113.10)
2) SSH access to the VPS (root password or SSH key)
3) Ubuntu 22.04 or 20.04 on the VPS

Folder used on the VPS
- /opt/amak

What you will get at the end
- Frontend: https://amabakent.uk
- API: https://api.amabakent.uk/api/v1
- PostgreSQL: runs only inside the server (NOT exposed to the internet)

READ THIS FIRST (SUPER SIMPLE)
- Every step below is copy/paste.
- Only replace words like YOUR_VPS_IP, <your-org-or-user>, and CHANGE_ME.
- When a step says “Paste this”, paste the whole block.


PART 1) Point Namecheap DNS to your VPS (IMPORTANT)

1) Log into Namecheap
2) Domain List -> Manage -> Advanced DNS
3) Add/Update these DNS records:

A Record
- Host: @
- Value: YOUR_VPS_IP
- TTL: Automatic

A Record
- Host: www
- Value: YOUR_VPS_IP
- TTL: Automatic

A Record
- Host: api
- Value: YOUR_VPS_IP
- TTL: Automatic

4) Wait for DNS to propagate.

Optional quick check (run on your PC):
nslookup amabakent.uk
nslookup api.amabakent.uk


PART 2) First-time VPS setup (Ubuntu)

Copy/paste this command to SSH into the server (from your PC):
ssh root@YOUR_VPS_IP

Copy/paste these commands:
apt update && apt -y upgrade
apt -y install ca-certificates curl gnupg ufw git

Copy/paste these commands:
ufw allow OpenSSH
ufw allow 80
ufw allow 443
ufw --force enable
ufw status


PART 3) Install Docker + Docker Compose

Copy/paste this command to install Docker:
curl -fsSL https://get.docker.com | sh

Copy/paste this command (optional):
usermod -aG docker $USER

If you ran the command above, log out and log in again (or reboot) for it to apply.

Copy/paste this command:
apt -y install docker-compose-plugin

docker --version
docker compose version


PART 4) Put the code on the VPS

Copy/paste these commands:
mkdir -p /opt/amak
cd /opt/amak

Clone your repo (choose ONE option)

Option A (copy/paste): Clone via HTTPS (recommended)
git clone https://github.com/<your-org-or-user>/amaK.git .

Option B: If you already copied the project to VPS, skip cloning.


PART 5) Create your production environment files (VERY IMPORTANT)

IMPORTANT: Do NOT expose secrets in frontend code. Keep secrets on the server.

Step A) Backend env file

Copy/paste this command to open the file:
nano /opt/amak/backend/.env

Paste this EXACTLY, then replace the values that say CHANGE_ME:

NODE_ENV=production
PORT=5000

# Postgres runs inside docker as service name: db
DATABASE_URL=postgresql://amak_user:CHANGE_ME_STRONG_DB_PASSWORD@db:5432/amabkinaata

JWT_SECRET=CHANGE_ME_LONG_RANDOM
JWT_REFRESH_SECRET=CHANGE_ME_LONG_RANDOM
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

ADMIN_EMAIL=CHANGE_ME_ADMIN_EMAIL
ADMIN_PASSWORD=CHANGE_ME_ADMIN_PASSWORD

PAYSTACK_SECRET_KEY=CHANGE_ME
PAYSTACK_PUBLIC_KEY=CHANGE_ME
PAYSTACK_WEBHOOK_SECRET=CHANGE_ME

BASE_URL=https://amabakent.uk

ENCARTA_BASE_URL=https://encartastores.com/api
ENCARTA_API_KEY=CHANGE_ME
ENCARTA_STATUS_URL=
ENCARTA_STATUS_THROTTLE_MS=60000

Step B) Frontend env file

Copy/paste this command to open the file:
nano /opt/amak/frontend/.env.production

Paste this:
NEXT_PUBLIC_API_URL=https://api.amabakent.uk/api/v1

Note
- Your frontend code uses NEXT_PUBLIC_API_URL to call the backend.


PART 6) Create Docker files (recommended)

If your repo already has Dockerfiles/docker-compose, use them.
If it does not, use the following minimal setup.

Step 1) Create /opt/amak/docker-compose.yml

Copy/paste this command to open the file:
nano /opt/amak/docker-compose.yml

Paste this EXACTLY, then change STRONG_DB_PASSWORD to match what you used above:

version: "3.9"
services:
  db:
    image: postgres:15
    container_name: amak_db
    restart: unless-stopped
    environment:
      POSTGRES_DB: amabkinaata
      POSTGRES_USER: amak_user
      POSTGRES_PASSWORD: CHANGE_ME_STRONG_DB_PASSWORD
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - amak

  backend:
    build:
      context: ./backend
    container_name: amak_backend
    restart: unless-stopped
    env_file:
      - ./backend/.env
    depends_on:
      - db
    networks:
      - amak

  frontend:
    build:
      context: ./frontend
      args:
        - NEXT_PUBLIC_API_URL=https://api.amabakent.uk/api/v1
    container_name: amak_frontend
    restart: unless-stopped
    depends_on:
      - backend
    networks:
      - amak

  nginx:
    image: nginx:alpine
    container_name: amak_nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./deploy/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./deploy/certbot/www:/var/www/certbot:ro
      - ./deploy/certbot/conf:/etc/letsencrypt:ro
    depends_on:
      - frontend
      - backend
    networks:
      - amak

  certbot:
    image: certbot/certbot
    container_name: amak_certbot
    volumes:
      - ./deploy/certbot/www:/var/www/certbot
      - ./deploy/certbot/conf:/etc/letsencrypt

networks:
  amak:

volumes:
  postgres_data:


Step 2) Create backend Dockerfile: /opt/amak/backend/Dockerfile

Copy/paste this command to open the file:
nano /opt/amak/backend/Dockerfile

Paste:

FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
EXPOSE 5000
CMD ["node", "src/server.js"]

NOTE: Your backend starts from src/server.js in this repo.


Step 3) Create frontend Dockerfile: /opt/amak/frontend/Dockerfile

Copy/paste this command to open the file:
nano /opt/amak/frontend/Dockerfile

Paste:

FROM node:20-alpine AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci

FROM node:20-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
ARG NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
RUN npm run build

FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV=production
COPY --from=builder /app .
EXPOSE 3000
CMD ["npm", "run", "start", "--", "-p", "3000"]


Step 4) Create Nginx config: /opt/amak/deploy/nginx.conf

Copy/paste these commands:
mkdir -p /opt/amak/deploy
nano /opt/amak/deploy/nginx.conf

Paste this (domain already set to amabakent.uk):

server {
  listen 80;
  server_name amabakent.uk www.amabakent.uk;

  location /.well-known/acme-challenge/ {
    root /var/www/certbot;
  }

  location / {
    proxy_pass http://frontend:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}

server {
  listen 80;
  server_name api.amabakent.uk;

  location /.well-known/acme-challenge/ {
    root /var/www/certbot;
  }

  location / {
    proxy_pass http://backend:5000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}


PART 7) Start everything (HTTP first)

Copy/paste these commands:
cd /opt/amak
docker compose up -d --build
docker compose ps

At this point:
- Frontend: http://amabakent.uk
- API: http://api.amabakent.uk


PART 8) Add HTTPS (Let’s Encrypt)

1) Create certbot folders (copy/paste):
mkdir -p /opt/amak/deploy/certbot/www
mkdir -p /opt/amak/deploy/certbot/conf

Step 2) Request certificates (copy/paste)

docker compose run --rm certbot certonly \
  --webroot \
  -w /var/www/certbot \
  -d amabakent.uk -d www.amabakent.uk -d api.amabakent.uk \
  --email CHANGE_ME_YOUR_EMAIL \
  --agree-tos \
  --no-eff-email

3) Update Nginx config to use SSL
Edit /opt/amak/deploy/nginx.conf and add HTTPS servers.

Step 3) Enable HTTPS in Nginx

Copy/paste this command to open the file:
nano /opt/amak/deploy/nginx.conf

Then append these HTTPS blocks below the existing HTTP blocks:

server {
  listen 443 ssl;
  server_name amabakent.uk www.amabakent.uk;

  ssl_certificate /etc/letsencrypt/live/amabakent.uk/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/amabakent.uk/privkey.pem;

  location / {
    proxy_pass http://frontend:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
  }
}

server {
  listen 443 ssl;
  server_name api.amabakent.uk;

  ssl_certificate /etc/letsencrypt/live/amabakent.uk/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/amabakent.uk/privkey.pem;

  location / {
    proxy_pass http://backend:5000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
  }
}

Step 4) Restart nginx (copy/paste):
cd /opt/amak
docker compose restart nginx

5) (Optional) Force HTTP->HTTPS redirect
Add a redirect block to your port 80 servers once HTTPS works.


PART 9) Database migrations (ONLY if your backend uses Prisma)

This depends on your backend.
If you use Prisma, you would run inside the backend container:

Copy/paste these commands:
cd /opt/amak
docker compose exec backend npx prisma migrate deploy

If you have seed scripts:
docker compose exec backend npm run prisma:seed


PART 10) Useful commands

See logs (copy/paste one line at a time):
docker compose logs -f --tail=200
docker compose logs -f backend
docker compose logs -f frontend
docker compose logs -f nginx

Restart everything (copy/paste):
docker compose restart

Rebuild after code changes (copy/paste):
docker compose up -d --build

Stop (copy/paste):
docker compose down


PART 11) Backups (PostgreSQL)

Manual backup (copy/paste):
cd /opt/amak
docker compose exec db pg_dump -U amak_user amabkinaata > /root/amabkinaata_backup.sql

Restore (copy/paste):
cat /root/amabkinaata_backup.sql | docker compose exec -T db psql -U amak_user -d amabkinaata


IMPORTANT NOTES
- Keep PostgreSQL NOT exposed to the internet. Only the backend should access it.
- Keep ENCARTA_API_KEY and PAYSTACK_SECRET_KEY on the server only.
- If your backend entry file is not src/index.js, change the backend Dockerfile CMD.
- If your frontend uses a different start command, adjust the frontend Dockerfile.

If you want, tell me your VPS provider + Ubuntu version and I’ll tailor these steps to it.
